<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æé€Ÿçº¯å‡€å½±é™¢ - å…è´¹åœ¨çº¿è§‚çœ‹VIPå½±è§†</title>
    <meta name="description" content="å…è´¹åœ¨çº¿è§‚çœ‹çˆ±å¥‡è‰ºã€è…¾è®¯è§†é¢‘ã€ä¼˜é…·ã€èŠ’æœTVç­‰å¹³å°VIPå½±è§†èµ„æºï¼Œæ— å¹¿å‘Šçº¯å‡€æ’­æ”¾ä½“éªŒï¼Œæ”¯æŒæœç´¢å’Œé“¾æ¥è§£æä¸¤ç§æ¨¡å¼">
    <meta name="keywords" content="å…è´¹VIPè§†é¢‘,åœ¨çº¿çœ‹ç”µå½±,å½±è§†è§£æ,æ— å¹¿å‘Šæ’­æ”¾,çˆ±å¥‡è‰ºè§£æ,è…¾è®¯è§†é¢‘è§£æ">
    <meta property="og:title" content="æé€Ÿçº¯å‡€å½±é™¢">
    <meta property="og:description" content="å…¨ç½‘VIPè§†é¢‘å…è´¹çœ‹ï¼Œæ— å¹¿å‘Šçº¯å‡€æ’­æ”¾">
    <meta property="og:type" content="website">
    <meta name="theme-color" content="#667eea">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/dplayer/dist/DPlayer.min.css">
    <script src="https://cdn.jsdelivr.net/npm/hls.js/dist/hls.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dplayer/dist/DPlayer.min.js"></script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: "Microsoft YaHei", "PingFang SC", sans-serif;
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding: 30px 20px;
        }

        @keyframes gradientBG {
            0% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }

            100% {
                background-position: 0% 50%;
            }
        }

        /* ä¸»å¡ç‰‡å®¹å™¨ */
        .main-card {
            width: 100%;
            max-width: 480px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 24px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            backdrop-filter: blur(10px);
        }

        /* é¡¶éƒ¨æ¨ªå¹… */
        .banner {
            width: 100%;
            height: 180px;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
            overflow: hidden;
        }

        .banner::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 60%);
            animation: shimmer 3s ease-in-out infinite;
        }

        @keyframes shimmer {

            0%,
            100% {
                transform: translate(0, 0);
            }

            50% {
                transform: translate(30%, 30%);
            }
        }

        .banner h1 {
            color: #fff;
            font-size: 32px;
            font-weight: 700;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            z-index: 1;
            letter-spacing: 4px;
        }

        .banner p {
            color: rgba(255, 255, 255, 0.8);
            font-size: 14px;
            margin-top: 10px;
            z-index: 1;
        }

        /* å†…å®¹åŒº */
        .content {
            padding: 24px;
        }

        /* å…¬å‘Šæ»šåŠ¨ */
        .notice {
            background: linear-gradient(90deg, #fff3cd, #ffeeba);
            padding: 10px 16px;
            border-radius: 20px;
            margin-bottom: 20px;
            font-size: 13px;
            color: #856404;
            text-align: center;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.8;
            }
        }

        /* è§†é¢‘å¹³å°æŒ‰é’®ç»„ */
        .platform-section {
            margin-bottom: 24px;
        }

        .section-title {
            font-size: 14px;
            color: #666;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .section-title::before {
            content: 'ğŸ¬';
        }

        .platform-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }

        .platform-btn {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border: none;
            border-radius: 12px;
            padding: 14px 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            text-decoration: none;
        }

        .platform-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        }

        .platform-btn img {
            width: 32px;
            height: 32px;
            border-radius: 8px;
        }

        .platform-btn span {
            font-size: 12px;
            color: #333;
            font-weight: 500;
        }

        /* çˆ±å¥‡è‰º */
        .platform-btn.iqiyi {
            background: linear-gradient(135deg, #00be06 0%, #00a305 100%);
        }

        .platform-btn.iqiyi span {
            color: #fff;
        }

        /* è…¾è®¯ */
        .platform-btn.tencent {
            background: linear-gradient(135deg, #ff6a00 0%, #ee5500 100%);
        }

        .platform-btn.tencent span {
            color: #fff;
        }

        /* ä¼˜é…· */
        .platform-btn.youku {
            background: linear-gradient(135deg, #1e90ff 0%, #0070dd 100%);
        }

        .platform-btn.youku span {
            color: #fff;
        }

        /* èŠ’æœ */
        .platform-btn.mango {
            background: linear-gradient(135deg, #ff8c00 0%, #ff6600 100%);
        }

        .platform-btn.mango span {
            color: #fff;
        }

        /* Bç«™ */
        .platform-btn.bilibili {
            background: linear-gradient(135deg, #fb7299 0%, #f25d8e 100%);
        }

        .platform-btn.bilibili span {
            color: #fff;
        }

        /* æœç‹ */
        .platform-btn.sohu {
            background: linear-gradient(135deg, #d43c33 0%, #c0332a 100%);
        }

        .platform-btn.sohu span {
            color: #fff;
        }

        /* åˆ†éš”çº¿ */
        .divider {
            height: 1px;
            background: linear-gradient(90deg, transparent, #ddd, transparent);
            margin: 20px 0;
        }

        /* æœç´¢åŒºåŸŸ */
        .search-section {
            margin-bottom: 20px;
        }

        .input-wrapper {
            position: relative;
            margin-bottom: 16px;
        }

        .search-input {
            width: 100%;
            padding: 16px 20px;
            border: 2px solid #e9ecef;
            border-radius: 50px;
            font-size: 15px;
            outline: none;
            transition: all 0.3s ease;
            background: #f8f9fa;
        }

        .search-input:focus {
            border-color: #667eea;
            background: #fff;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
        }

        .search-input::placeholder {
            color: #aaa;
        }

        /* è·¯çº¿é€‰æ‹© */
        .route-section {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin-bottom: 20px;
        }

        .route-btn {
            padding: 10px 24px;
            border: 2px solid #e9ecef;
            border-radius: 50px;
            background: #fff;
            cursor: pointer;
            font-size: 14px;
            color: #666;
            transition: all 0.3s ease;
        }

        .route-btn:hover {
            border-color: #667eea;
            color: #667eea;
        }

        .route-btn.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-color: transparent;
            color: #fff;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        /* ä¸»æŒ‰é’® */
        .main-btn {
            width: 100%;
            padding: 16px;
            border: none;
            border-radius: 50px;
            background: linear-gradient(135deg, #ff6b6b, #ee5a5a);
            color: #fff;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 6px 20px rgba(238, 90, 90, 0.4);
        }

        .main-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(238, 90, 90, 0.5);
        }

        .main-btn:active {
            transform: translateY(0);
        }

        /* åŒæŒ‰é’®ç»„ */
        .btn-group {
            display: flex;
            gap: 12px;
            margin-bottom: 12px;
        }

        .btn-group .main-btn {
            flex: 1;
            padding: 14px 12px;
            font-size: 15px;
        }

        /* æœç´¢æŒ‰é’® - ç´«è‰² */
        .search-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .search-btn:hover {
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }

        /* è§£ææŒ‰é’® - ç»¿è‰² */
        .parse-btn {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        }

        .parse-btn:hover {
            box-shadow: 0 10px 30px rgba(17, 153, 142, 0.4);
        }

        /* æŒ‰é’®é«˜äº®æ¨èçŠ¶æ€ */
        .btn-recommended {
            animation: btnPulse 1.5s ease-in-out infinite;
            position: relative;
        }

        .btn-recommended::after {
            content: 'æ¨è';
            position: absolute;
            top: -8px;
            right: -8px;
            background: #ff6b6b;
            color: #fff;
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 10px;
        }

        @keyframes btnPulse {

            0%,
            100% {
                box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
            }

            50% {
                box-shadow: 0 8px 25px rgba(102, 126, 234, 0.5);
            }
        }

        /* çŠ¶æ€æç¤º */
        #status {
            text-align: center;
            margin-top: 16px;
            font-size: 14px;
            color: #666;
            min-height: 20px;
        }

        /* æ’­æ”¾å™¨å®¹å™¨ - é»˜è®¤éšè— */
        .player-section {
            display: none;
            margin-top: 20px;
        }

        .player-section.show {
            display: block;
        }

        #dplayer {
            width: 100%;
            height: 270px;
            background: #000;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        /* ç½‘é¡µå…¨å±æŒ‰é’® */
        .player-controls {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 10px;
        }

        .fullpage-btn {
            padding: 8px 16px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #fff;
            border: none;
            border-radius: 8px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .fullpage-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        /* ç½‘é¡µå…¨å±æ¨¡å¼ */
        .fullpage-mode {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 100vw !important;
            height: 100vh !important;
            z-index: 9999 !important;
            background: #000 !important;
            border-radius: 0 !important;
            margin: 0 !important;
            padding: 0 !important;
        }

        .fullpage-mode #dplayer {
            height: calc(100vh - 60px) !important;
            border-radius: 0 !important;
        }

        .fullpage-mode .player-controls {
            position: fixed;
            bottom: 10px;
            right: 20px;
            z-index: 10000;
        }

        .fullpage-mode .episodes-section {
            display: none;
        }

        /* é€€å‡ºå…¨å±æŒ‰é’®æ ·å¼ */
        .exit-fullpage-btn {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
        }

        /* é€‰é›†åŒºåŸŸ */
        .episodes-section {
            margin-top: 16px;
            max-height: 200px;
            overflow-y: auto;
        }

        .ep-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
        }

        .ep-btn {
            background: #f0f0f0;
            padding: 10px 8px;
            text-align: center;
            border-radius: 8px;
            cursor: pointer;
            font-size: 12px;
            color: #333;
            transition: all 0.2s ease;
            border: 2px solid transparent;
        }

        .ep-btn:hover {
            background: #e0e0e0;
        }

        .ep-btn.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: #fff;
            border-color: transparent;
        }

        /* é¡µè„š */
        .footer {
            text-align: center;
            padding: 16px;
            font-size: 12px;
            color: #999;
            border-top: 1px solid #eee;
        }

        .footer a {
            color: #667eea;
            text-decoration: none;
        }

        /* æ»šåŠ¨æ¡ç¾åŒ– */
        .episodes-section::-webkit-scrollbar {
            width: 6px;
        }

        .episodes-section::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 3px;
        }

        .episodes-section::-webkit-scrollbar-thumb {
            background: #ccc;
            border-radius: 3px;
        }

        .episodes-section::-webkit-scrollbar-thumb:hover {
            background: #999;
        }
    </style>
</head>

<body>

    <div class="main-card">
        <!-- é¡¶éƒ¨æ¨ªå¹… -->
        <div class="banner">
            <h1>ğŸ¬ æé€Ÿçº¯å‡€å½±é™¢</h1>
            <p>å…¨ç½‘VIPè§†é¢‘å…è´¹çœ‹ Â· æ— å¹¿å‘Šçº¯å‡€æ’­æ”¾</p>
        </div>

        <div class="content">
            <!-- å…¬å‘Š -->
            <div class="notice">
                ğŸ’¡ æœç´¢å‰§åçœ‹å…¨é›† Â· ç²˜è´´é“¾æ¥è§£æVIP
            </div>

            <!-- è§†é¢‘å¹³å°å…¥å£ -->
            <div class="platform-section">
                <div class="section-title">å»å®˜ç½‘æ‰¾èµ„æº</div>
                <div class="platform-grid">
                    <a href="https://www.iqiyi.com/" target="_blank" class="platform-btn iqiyi">
                        <span>ğŸ¬ çˆ±å¥‡è‰º</span>
                    </a>
                    <a href="https://v.qq.com/" target="_blank" class="platform-btn tencent">
                        <span>ğŸ“º è…¾è®¯è§†é¢‘</span>
                    </a>
                    <a href="https://www.youku.com/" target="_blank" class="platform-btn youku">
                        <span>ğŸ¥ ä¼˜é…·</span>
                    </a>
                    <a href="https://www.mgtv.com/" target="_blank" class="platform-btn mango">
                        <span>ğŸ¥­ èŠ’æœTV</span>
                    </a>
                    <a href="https://www.bilibili.com/" target="_blank" class="platform-btn bilibili">
                        <span>ğŸ“± Bç«™</span>
                    </a>
                    <a href="https://tv.sohu.com/" target="_blank" class="platform-btn sohu">
                        <span>ğŸ”´ æœç‹</span>
                    </a>
                </div>
            </div>

            <div class="divider"></div>

            <!-- æœç´¢åŒºåŸŸ -->
            <div class="search-section">
                <div class="input-wrapper">
                    <input type="text" id="keyword" class="search-input" placeholder="è¾“å…¥å‰§åæœç´¢ æˆ– ç²˜è´´è§†é¢‘é“¾æ¥è§£æ..."
                        onkeypress="if(event.keyCode==13) handleSearch()">
                </div>

                <!-- è·¯çº¿é€‰æ‹© -->
                <div class="route-section">
                    <button class="route-btn active" data-route="1" onclick="selectRoute(1)">çº¿è·¯1</button>
                    <button class="route-btn" data-route="2" onclick="selectRoute(2)">çº¿è·¯2</button>
                    <button class="route-btn" data-route="3" onclick="selectRoute(3)">çº¿è·¯3</button>
                </div>

                <!-- åŒæŒ‰é’®ç»„ -->
                <div class="btn-group">
                    <button id="searchBtn" class="main-btn search-btn" onclick="doSearch()">ğŸ” æœç´¢å½±è§†</button>
                    <button id="parseBtn" class="main-btn parse-btn" onclick="doParse()">ğŸ¬ è§£æé“¾æ¥</button>
                </div>

                <div id="status"></div>
            </div>

            <!-- æ’­æ”¾å™¨åŒºåŸŸ -->
            <div class="player-section" id="playerSection">
                <div id="dplayer"></div>
                <div class="player-controls">
                    <button id="fullpageBtn" class="fullpage-btn" onclick="toggleFullpage()">
                        <span id="fullpageIcon">â›¶</span>
                        <span id="fullpageText">ç½‘é¡µå…¨å±</span>
                    </button>
                </div>
                <div class="episodes-section">
                    <div id="episodes" class="ep-grid"></div>
                </div>
            </div>
        </div>

        <!-- é¡µè„š -->
        <div class="footer">
            å†…å®¹ä»…ä¾›å­¦ä¹ å‚è€ƒ Â· è¯·æ”¯æŒæ­£ç‰ˆ
        </div>
    </div>

    <script>
        let dp = null;
        let currentRoute = 1;
        let isFullpage = false;

        // ç½‘é¡µå…¨å±åˆ‡æ¢
        function toggleFullpage() {
            const playerSection = document.getElementById('playerSection');
            const btn = document.getElementById('fullpageBtn');
            const icon = document.getElementById('fullpageIcon');
            const text = document.getElementById('fullpageText');

            isFullpage = !isFullpage;

            if (isFullpage) {
                playerSection.classList.add('fullpage-mode');
                btn.classList.add('exit-fullpage-btn');
                icon.textContent = 'âœ•';
                text.textContent = 'é€€å‡ºå…¨å±';
                document.body.style.overflow = 'hidden';
            } else {
                playerSection.classList.remove('fullpage-mode');
                btn.classList.remove('exit-fullpage-btn');
                icon.textContent = 'â›¶';
                text.textContent = 'ç½‘é¡µå…¨å±';
                document.body.style.overflow = '';
            }
        }

        // ESCé”®é€€å‡ºç½‘é¡µå…¨å±
        document.addEventListener('keydown', function (e) {
            if (e.key === 'Escape' && isFullpage) {
                toggleFullpage();
            }
        });

        // é€‰æ‹©è·¯çº¿
        function selectRoute(route) {
            currentRoute = route;
            document.querySelectorAll('.route-btn').forEach(btn => {
                btn.classList.toggle('active', parseInt(btn.dataset.route) === route);
            });
        }

        // åˆå§‹åŒ–æ’­æ”¾å™¨
        function initPlayer() {
            if (dp) {
                dp.destroy();
            }
            dp = new DPlayer({
                container: document.getElementById('dplayer'),
                video: { url: '', type: 'auto' },
                theme: '#667eea',
                autoplay: false,
                preload: 'auto',
                volume: 0.7,
                mutex: true,
                screenshot: true,
                hotkey: true
            });

            dp.on('canplay', function () {
                updateStatus('âœ… è§†é¢‘åŠ è½½å®Œæˆ', '#28a745');
            });

            dp.on('error', function () {
                updateStatus('âŒ æ’­æ”¾å‡ºé”™ï¼Œè¯·å°è¯•åˆ‡æ¢çº¿è·¯', '#dc3545');
            });
        }

        // æ›´æ–°çŠ¶æ€
        function updateStatus(text, color = '#666') {
            const status = document.getElementById('status');
            status.innerText = text;
            status.style.color = color;
        }

        // æ˜¾ç¤ºæ’­æ”¾å™¨
        function showPlayer() {
            document.getElementById('playerSection').classList.add('show');
            if (!dp) initPlayer();
        }

        // å¤„ç†æœç´¢/è§£æï¼ˆä¿ç•™å‘åå…¼å®¹ï¼‰
        async function handleSearch() {
            const input = document.getElementById('keyword').value.trim();
            if (!input) {
                updateStatus('âš ï¸ è¯·è¾“å…¥å‰§åæˆ–è§†é¢‘ç½‘å€', '#ffc107');
                return;
            }

            // åˆ¤æ–­æ˜¯å¦ä¸ºURL
            if (isUrl(input)) {
                doParse();
            } else {
                doSearch();
            }
        }

        // åˆ¤æ–­æ˜¯å¦ä¸ºURL
        function isUrl(str) {
            return str.startsWith('http://') || str.startsWith('https://');
        }

        // æœç´¢æŒ‰é’®ç‚¹å‡»
        function doSearch() {
            const input = document.getElementById('keyword').value.trim();
            if (!input) {
                updateStatus('âš ï¸ è¯·è¾“å…¥å½±è§†å‰§åç§°', '#ffc107');
                return;
            }
            if (isUrl(input)) {
                updateStatus('ğŸ’¡ æ£€æµ‹åˆ°é“¾æ¥ï¼Œå»ºè®®ç‚¹å‡»ã€Œè§£æé“¾æ¥ã€æŒ‰é’®', '#667eea');
                return;
            }
            searchVideo(input);
        }

        // è§£ææŒ‰é’®ç‚¹å‡»
        function doParse() {
            const input = document.getElementById('keyword').value.trim();
            if (!input) {
                updateStatus('âš ï¸ è¯·ç²˜è´´è§†é¢‘é“¾æ¥', '#ffc107');
                return;
            }
            if (!isUrl(input)) {
                updateStatus('ğŸ’¡ è¿™ä¸æ˜¯é“¾æ¥ï¼Œå»ºè®®ç‚¹å‡»ã€Œæœç´¢å½±è§†ã€æŒ‰é’®', '#667eea');
                return;
            }
            parseUrl(input);
        }

        // æ™ºèƒ½æ£€æµ‹è¾“å…¥å†…å®¹ï¼Œé«˜äº®æ¨èæŒ‰é’®
        function updateButtonRecommendation() {
            const input = document.getElementById('keyword').value.trim();
            const searchBtn = document.getElementById('searchBtn');
            const parseBtn = document.getElementById('parseBtn');

            // æ¸…é™¤æ‰€æœ‰æ¨èçŠ¶æ€
            searchBtn.classList.remove('btn-recommended');
            parseBtn.classList.remove('btn-recommended');

            if (!input) return;

            if (isUrl(input)) {
                parseBtn.classList.add('btn-recommended');
            } else {
                searchBtn.classList.add('btn-recommended');
            }
        }

        // æ¸…ç†URLï¼Œç§»é™¤è¿½è¸ªå‚æ•°
        function cleanVideoUrl(url) {
            try {
                // ä¿ç•™åŸºæœ¬URLï¼Œç§»é™¤?åçš„æ‰€æœ‰è¿½è¸ªå‚æ•°
                const urlObj = new URL(url);

                // é’ˆå¯¹ä¸åŒå¹³å°çš„URLæ ¼å¼å¤„ç†
                // è…¾è®¯è§†é¢‘: https://v.qq.com/x/cover/xxx/xxx.html?params -> ä¿ç•™.htmlå‰çš„éƒ¨åˆ†
                // çˆ±å¥‡è‰º: https://www.iqiyi.com/v_xxx.html?params -> ä¿ç•™.htmlå‰çš„éƒ¨åˆ†
                // ä¼˜é…·: https://v.youku.com/v_show/id_xxx.html?params -> ä¿ç•™.htmlå‰çš„éƒ¨åˆ†

                // é€šç”¨å¤„ç†ï¼šç§»é™¤æ‰€æœ‰æŸ¥è¯¢å‚æ•°
                const cleanUrl = urlObj.origin + urlObj.pathname;
                console.log('åŸå§‹URL:', url);
                console.log('æ¸…ç†åURL:', cleanUrl);
                return cleanUrl;
            } catch (e) {
                console.error('URLæ¸…ç†å¤±è´¥:', e);
                return url; // å¦‚æœè§£æå¤±è´¥ï¼Œè¿”å›åŸå§‹URL
            }
        }

        // å­˜å‚¨å½“å‰ç”µè§†å‰§ä¿¡æ¯
        let currentSeriesInfo = null;

        // è§£æå¹³å°URLï¼Œæå–ç”µè§†å‰§ä¿¡æ¯
        function parseSeriesInfo(url) {
            const cleanedUrl = cleanVideoUrl(url);
            let platform = '';
            let seriesId = '';
            let episodeId = '';

            try {
                const urlObj = new URL(cleanedUrl);
                const pathname = urlObj.pathname;

                // è…¾è®¯è§†é¢‘: https://v.qq.com/x/cover/[seriesId]/[episodeId].html
                if (urlObj.hostname.includes('qq.com')) {
                    platform = 'qq';
                    const match = pathname.match(/\/x\/cover\/([^\/]+)\/([^\.]+)\.html/);
                    if (match) {
                        seriesId = match[1];
                        episodeId = match[2];
                    }
                }
                // çˆ±å¥‡è‰º: https://www.iqiyi.com/v_[episodeId].html æˆ– a_[seriesId].html
                else if (urlObj.hostname.includes('iqiyi.com')) {
                    platform = 'iqiyi';
                    const vMatch = pathname.match(/\/v_([^\.]+)\.html/);
                    const aMatch = pathname.match(/\/a_([^\.]+)\.html/);
                    if (vMatch) {
                        episodeId = vMatch[1];
                    }
                    if (aMatch) {
                        seriesId = aMatch[1];
                    }
                }
                // ä¼˜é…·: https://v.youku.com/v_show/id_[episodeId].html
                else if (urlObj.hostname.includes('youku.com')) {
                    platform = 'youku';
                    const match = pathname.match(/id_([^\.]+)/);
                    if (match) {
                        episodeId = match[1];
                    }
                }
                // èŠ’æœTV
                else if (urlObj.hostname.includes('mgtv.com')) {
                    platform = 'mgtv';
                }
                // Bç«™
                else if (urlObj.hostname.includes('bilibili.com')) {
                    platform = 'bilibili';
                }
            } catch (e) {
                console.error('è§£æURLå¤±è´¥:', e);
            }

            return { platform, seriesId, episodeId, cleanedUrl };
        }

        // æ„å»ºé€‰é›†URLï¼ˆæ ¹æ®å¹³å°ï¼‰
        function buildEpisodeUrl(platform, seriesId, episodeId, baseUrl) {
            switch (platform) {
                case 'qq':
                    // è…¾è®¯è§†é¢‘æ ¼å¼
                    return `https://v.qq.com/x/cover/${seriesId}/${episodeId}.html`;
                default:
                    return baseUrl;
            }
        }

        // è§£æURL
        async function parseUrl(url) {
            updateStatus('ğŸ” æ­£åœ¨è§£æè§†é¢‘åœ°å€...', '#667eea');
            showPlayer();

            // å…ˆæ¸…ç†URLä¸­çš„è¿½è¸ªå‚æ•°
            const cleanedUrl = cleanVideoUrl(url);

            // è§£æç”µè§†å‰§ä¿¡æ¯
            const seriesInfo = parseSeriesInfo(url);
            currentSeriesInfo = seriesInfo;
            console.log('ç”µè§†å‰§ä¿¡æ¯:', seriesInfo);

            // å¤šä¸ªè§£ææ¥å£å¤‡é€‰ï¼ˆçº¯å‡€æ— å¹¿å‘Šä¼˜å…ˆï¼‰
            const parseApis = [
                // çº¿è·¯1: è™¾ç±³è§£æ - çº¯å‡€æ— å¹¿å‘Š âœ… æ¨è
                'https://jx.xmflv.com/?url=',
                // çº¿è·¯2: çˆ±è±†è§£æ - ç¨³å®šå¤‡ç”¨
                'https://jx.aidouer.net/?url=',
                // çº¿è·¯3: M3U8è§£æ - ç¨³å®šå¤‡ç”¨
                'https://jx.m3u8.tv/jiexi/?url='
            ];

            const finalUrl = parseApis[currentRoute - 1] + encodeURIComponent(cleanedUrl);

            // åˆ›å»ºiframeè§£æ
            const dplayerDiv = document.getElementById('dplayer');
            const listDiv = document.getElementById('episodes');

            // æ·»åŠ åŠ è½½åŠ¨ç”»
            dplayerDiv.innerHTML = `
                <div style="width:100%;height:100%;display:flex;justify-content:center;align-items:center;background:#1a1a2e;">
                    <div style="color:#fff;font-size:16px;">â³ è§†é¢‘è§£æä¸­...</div>
                </div>
            `;

            // å»¶è¿Ÿæ’å…¥iframe
            setTimeout(() => {
                // ä½¿ç”¨sandboxé™åˆ¶iframeè¡Œä¸ºï¼Œé˜»æ­¢å¹¿å‘Šå¼¹çª—
                // sandbox="allow-scripts allow-same-origin" é˜»æ­¢å¼¹çª—å’Œé¡¶çº§å¯¼èˆª
                dplayerDiv.innerHTML = `
                    <div style="position:relative;width:100%;height:100%;">
                        <iframe 
                            src="${finalUrl}" 
                            style="width:100%;height:100%;border:none;" 
                            allowfullscreen
                            referrerpolicy="no-referrer"
                            sandbox="allow-scripts allow-same-origin allow-presentation allow-forms"
                        ></iframe>
                    </div>
                `;
                updateStatus('âœ… è§£ææˆåŠŸï¼Œæ­£åœ¨æ’­æ”¾', '#28a745');

                // æ³¨å…¥å¹¿å‘Šå±è”½
                blockIframeAds();
            }, 500);

            // å¦‚æœæ˜¯è…¾è®¯è§†é¢‘ç”µè§†å‰§ï¼Œå°è¯•ç”Ÿæˆé€‰é›†
            if (seriesInfo.platform === 'qq' && seriesInfo.seriesId) {
                generateQQEpisodes(seriesInfo.seriesId, seriesInfo.episodeId, listDiv);
            } else if (seriesInfo.platform === 'iqiyi') {
                // çˆ±å¥‡è‰º - æç¤ºç”¨æˆ·ä½¿ç”¨æœç´¢åŠŸèƒ½è·å–é€‰é›†
                listDiv.innerHTML = `
                    <div style="grid-column: 1/-1; text-align:center; padding:10px; color:#666; font-size:13px;">
                        ğŸ’¡ æç¤ºï¼šæƒ³çœ‹å…¶ä»–é›†ï¼Ÿè¯•è¯•åœ¨ä¸Šæ–¹æœç´¢æ¡†è¾“å…¥å‰§åæœç´¢ï¼Œå¯è·å–å®Œæ•´é€‰é›†åˆ—è¡¨
                    </div>
                `;
            } else {
                // å…¶ä»–å¹³å°ä¹Ÿç»™æç¤º
                listDiv.innerHTML = `
                    <div style="grid-column: 1/-1; text-align:center; padding:10px; color:#666; font-size:13px;">
                        ğŸ’¡ æç¤ºï¼šå¦‚éœ€é€‰é›†åŠŸèƒ½ï¼Œè¯·åœ¨æœç´¢æ¡†è¾“å…¥å‰§åæœç´¢
                    </div>
                `;
            }
        }

        // ç”Ÿæˆè…¾è®¯è§†é¢‘é€‰é›†æŒ‰é’®ï¼ˆç®€æ˜“ç‰ˆï¼ŒåŸºäºURLè§„å¾‹ï¼‰
        function generateQQEpisodes(seriesId, currentEpId, listDiv) {
            listDiv.innerHTML = '';

            // è…¾è®¯è§†é¢‘é€‰é›†éœ€è¦è°ƒç”¨APIè·å–ï¼Œè¿™é‡Œå…ˆæä¾›æ‰‹åŠ¨è¾“å…¥æ–¹å¼
            // åˆ›å»ºé€‰é›†è¾“å…¥åŒº
            const inputArea = document.createElement('div');
            inputArea.style.cssText = 'grid-column: 1/-1; margin-bottom: 10px;';
            inputArea.innerHTML = `
                <div style="display:flex; gap:8px; align-items:center; flex-wrap:wrap;">
                    <span style="font-size:13px; color:#666;">ğŸ“º å¿«é€Ÿè·³é›†ï¼š</span>
                    <input type="number" id="epJumpInput" min="1" placeholder="è¾“å…¥é›†æ•°" 
                        style="width:80px; padding:6px 10px; border:1px solid #ddd; border-radius:6px; font-size:13px;">
                    <button onclick="jumpToEpisode()" 
                        style="padding:6px 12px; background:linear-gradient(135deg,#667eea,#764ba2); color:#fff; border:none; border-radius:6px; cursor:pointer; font-size:13px;">
                        è·³è½¬
                    </button>
                    <span style="font-size:12px; color:#999;">æˆ–ç²˜è´´å…¶ä»–é›†çš„é“¾æ¥</span>
                </div>
            `;
            listDiv.appendChild(inputArea);

            // æ˜¾ç¤ºå½“å‰é›†æ•°ä¿¡æ¯
            const infoDiv = document.createElement('div');
            infoDiv.style.cssText = 'grid-column: 1/-1; font-size:12px; color:#888; text-align:center;';
            infoDiv.innerHTML = `å½“å‰å‰§é›†ID: ${seriesId} | å½“å‰é›†: ${currentEpId}`;
            listDiv.appendChild(infoDiv);
        }

        // è·³è½¬åˆ°æŒ‡å®šé›†æ•°ï¼ˆé€šè¿‡æœç´¢å®ç°ï¼‰
        async function jumpToEpisode() {
            const epNum = document.getElementById('epJumpInput')?.value;
            if (!epNum || !currentSeriesInfo) {
                updateStatus('âš ï¸ è¯·è¾“å…¥æœ‰æ•ˆçš„é›†æ•°', '#ffc107');
                return;
            }

            updateStatus(`ğŸ” æ­£åœ¨æŸ¥æ‰¾ç¬¬${epNum}é›†...`, '#667eea');

            // ä½¿ç”¨æœç´¢APIæŸ¥æ‰¾å‰§é›†
            // ç”±äºè…¾è®¯è§†é¢‘çš„é›†æ•°IDä¸æ˜¯ç®€å•çš„æ•°å­—ï¼Œéœ€è¦é€šè¿‡æœç´¢æ¥è·å–
            // è¿™é‡Œç»™ç”¨æˆ·ä¸€ä¸ªæç¤º
            updateStatus(`ğŸ’¡ å»ºè®®ï¼šåœ¨æœç´¢æ¡†è¾“å…¥å‰§åæœç´¢ï¼Œå¯è·å–å®Œæ•´é€‰é›†`, '#667eea');
        }

        // ç›‘å¬äº‹ä»¶ï¼šç²˜è´´è‡ªåŠ¨è§£æ + è¾“å…¥æ™ºèƒ½æ¨è
        document.addEventListener('DOMContentLoaded', function () {
            const input = document.getElementById('keyword');

            // è¾“å…¥å˜åŒ–æ—¶æ›´æ–°æŒ‰é’®æ¨è
            input.addEventListener('input', updateButtonRecommendation);

            // ç²˜è´´äº‹ä»¶
            input.addEventListener('paste', function (e) {
                // å»¶è¿Ÿæ‰§è¡Œï¼Œç­‰å¾…ç²˜è´´å†…å®¹å¡«å…¥
                setTimeout(() => {
                    const pastedText = input.value.trim();
                    updateButtonRecommendation();
                    // å¦‚æœç²˜è´´çš„æ˜¯URLï¼Œè‡ªåŠ¨è§¦å‘è§£æ
                    if (isUrl(pastedText)) {
                        updateStatus('ğŸ”— æ£€æµ‹åˆ°è§†é¢‘é“¾æ¥ï¼Œè‡ªåŠ¨è§£æä¸­...', '#667eea');
                        setTimeout(() => doParse(), 300);
                    }
                }, 100);
            });
        });

        // æ£€æµ‹æ˜¯å¦ä¸ºé™æ€ç¯å¢ƒï¼ˆGitHub Pagesç­‰ï¼‰
        function isStaticHosting() {
            const hostname = window.location.hostname;
            return hostname.includes('github.io') ||
                hostname.includes('netlify') ||
                hostname.includes('vercel') ||
                hostname.includes('pages.dev');
        }

        // æœç´¢è§†é¢‘
        async function searchVideo(keyword) {
            // é™æ€ç¯å¢ƒä¸æ”¯æŒæœç´¢åŠŸèƒ½
            if (isStaticHosting()) {
                updateStatus('ğŸ’¡ é™æ€ç½‘ç«™æš‚ä¸æ”¯æŒæœç´¢åŠŸèƒ½ï¼Œè¯·ç›´æ¥ç²˜è´´è§†é¢‘é“¾æ¥è§£æ', '#667eea');
                const listDiv = document.getElementById('episodes');
                listDiv.innerHTML = `
                    <div style="grid-column: 1/-1; text-align:center; padding:20px; color:#666;">
                        <p style="font-size:14px; margin-bottom:10px;">ğŸ“‹ ä½¿ç”¨æ–¹æ³•ï¼š</p>
                        <p style="font-size:13px;">1. ç‚¹å‡»ä¸Šæ–¹å¹³å°æŒ‰é’®ï¼ˆçˆ±å¥‡è‰º/è…¾è®¯ç­‰ï¼‰</p>
                        <p style="font-size:13px;">2. æ‰¾åˆ°æƒ³çœ‹çš„è§†é¢‘ï¼Œå¤åˆ¶ç½‘å€</p>
                        <p style="font-size:13px;">3. ç²˜è´´åˆ°æœç´¢æ¡†ï¼Œç‚¹å‡»ã€Œè§£æé“¾æ¥ã€</p>
                    </div>
                `;
                return;
            }

            updateStatus('ğŸ” æ­£åœ¨å…¨ç½‘æœç´¢...', '#667eea');
            const listDiv = document.getElementById('episodes');
            listDiv.innerHTML = '';

            try {
                const res = await fetch(`/search?wd=${encodeURIComponent(keyword)}&rt=${currentRoute}`);
                const data = await res.json();

                if (data.error) {
                    updateStatus('âŒ ' + data.error, '#dc3545');
                    return;
                }

                if (!data.list || data.list.length === 0) {
                    updateStatus('ğŸ˜” æ²¡æœ‰æ‰¾åˆ°ç›¸å…³èµ„æºï¼Œæ¢ä¸ªå…³é”®è¯è¯•è¯•', '#ffc107');
                    return;
                }

                const vod = data.list[0];
                updateStatus(`âœ… æ‰¾åˆ°: ${vod.vod_name}`, '#28a745');

                showPlayer();
                initPlayer();

                // è§£æé€‰é›†
                const vodPlayUrl = vod.vod_play_url;
                let count = 0;

                if (vodPlayUrl && typeof vodPlayUrl === 'string') {
                    const playSources = vodPlayUrl.split('$$$');
                    let targetPlayStr = '';

                    for (const source of playSources) {
                        if (source.includes('.m3u8')) {
                            targetPlayStr = source;
                            break;
                        }
                    }

                    if (targetPlayStr) {
                        const arr = targetPlayStr.split('#');

                        arr.forEach((item) => {
                            if (item.includes('$') && item.includes('.m3u8')) {
                                const [name, url] = item.split('$');

                                const btn = document.createElement('div');
                                btn.className = 'ep-btn';
                                btn.innerText = name;

                                btn.onclick = () => {
                                    dp.switchVideo({ url: url, type: 'hls' });
                                    dp.play();
                                    document.querySelectorAll('.ep-btn').forEach(b => b.classList.remove('active'));
                                    btn.classList.add('active');
                                    updateStatus(`â–¶ï¸ æ­£åœ¨æ’­æ”¾: ${name}`, '#28a745');
                                };

                                listDiv.appendChild(btn);
                                count++;
                            }
                        });
                    }
                }

                if (count > 0) {
                    listDiv.children[0].click();
                } else {
                    updateStatus('âš ï¸ èµ„æºä¸æ˜¯m3u8æ ¼å¼ï¼Œå°è¯•ç²˜è´´ç½‘å€è§£æ', '#ffc107');
                }

            } catch (e) {
                console.error('æœç´¢å¤±è´¥:', e);
                updateStatus('âŒ è¯·æ±‚å¤±è´¥: ' + e.message, '#dc3545');
            }
        }

        // å¹¿å‘Šå±è”½åŠŸèƒ½
        function blockIframeAds() {
            const dplayerDiv = document.getElementById('dplayer');
            const iframe = dplayerDiv.querySelector('iframe');

            if (!iframe) return;

            // æ–¹æ³•1: ä½¿ç”¨MutationObserverç›‘æ§DOMå˜åŒ–ï¼Œç§»é™¤å¹¿å‘Šå…ƒç´ 
            try {
                iframe.addEventListener('load', function () {
                    try {
                        const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;

                        // æ³¨å…¥CSSéšè—å¸¸è§å¹¿å‘Šå…ƒç´ 
                        const adBlockStyle = document.createElement('style');
                        adBlockStyle.textContent = `
                            /* éšè—æš‚åœå¹¿å‘Š */
                            .pause-ad, .pause_ad, .pauseAd, .video-ad, .video_ad,
                            [class*="pause-ad"], [class*="pausead"], [class*="pause_ad"],
                            [class*="ad-pause"], [class*="adpause"], [class*="ad_pause"],
                            [class*="video-ad"], [class*="videoad"], [class*="video_ad"],
                            [id*="pause-ad"], [id*="pausead"], [id*="pause_ad"],
                            [id*="video-ad"], [id*="videoad"], [id*="video_ad"],
                            .ad-overlay, .adOverlay, .ad_overlay,
                            [class*="ad-overlay"], [class*="adoverlay"], [class*="ad_overlay"],
                            .player-ad, .playerAd, .player_ad,
                            [class*="player-ad"], [class*="playerad"], [class*="player_ad"],
                            div[class*="advertisement"], div[class*="å¹¿å‘Š"],
                            .pause-layer, .pauseLayer, [class*="pause-layer"],
                            .pause-poster, .pausePoster, [class*="pause-poster"],
                            .mask-layer, .maskLayer, [class*="mask"],
                            a[target="_blank"]:not([class*="play"]),
                            iframe[src*="ad"], iframe[src*="sponsor"],
                            div[style*="z-index: 999"], div[style*="z-index:999"],
                            div[style*="z-index: 9999"], div[style*="z-index:9999"],
                            .pop, .popup, [class*="popup"], [class*="pop-"],
                            .float, .floating, [class*="float"],
                            img[onclick], a > img[src*="ad"],
                            div[data-ad], span[data-ad] {
                                display: none !important;
                                visibility: hidden !important;
                                pointer-events: none !important;
                                opacity: 0 !important;
                                width: 0 !important;
                                height: 0 !important;
                            }
                            
                            /* ç¡®ä¿è§†é¢‘å¯ä»¥æ­£å¸¸ç‚¹å‡» */
                            video {
                                pointer-events: auto !important;
                            }
                        `;
                        iframeDoc.head.appendChild(adBlockStyle);

                        // å‘¨æœŸæ€§æ£€æµ‹å¹¶ç§»é™¤å¹¿å‘Š
                        const cleanAds = () => {
                            const adSelectors = [
                                '.pause-ad', '.pause_ad', '.pauseAd', '.video-ad',
                                '[class*="pause-ad"]', '[class*="ad-overlay"]',
                                '[class*="player-ad"]', 'a[target="_blank"]',
                                'div[style*="z-index: 9999"]', '.pop', '.popup'
                            ];

                            adSelectors.forEach(selector => {
                                try {
                                    const ads = iframeDoc.querySelectorAll(selector);
                                    ads.forEach(ad => {
                                        // æ£€æŸ¥æ˜¯å¦æ˜¯æ’­æ”¾æŒ‰é’®ç­‰å¿…è¦å…ƒç´ 
                                        if (!ad.classList.contains('play') &&
                                            !ad.classList.contains('dplayer') &&
                                            !ad.closest('.dplayer-video-wrap')) {
                                            ad.style.display = 'none';
                                            ad.style.visibility = 'hidden';
                                            ad.remove();
                                        }
                                    });
                                } catch (e) { }
                            });
                        };

                        // æ¯ç§’æ£€æµ‹ä¸€æ¬¡
                        setInterval(cleanAds, 1000);

                        // åˆæ¬¡æ¸…ç†
                        cleanAds();

                        console.log('âœ… å¹¿å‘Šå±è”½å·²å¯ç”¨');
                    } catch (e) {
                        // è·¨åŸŸé™åˆ¶ï¼Œæ— æ³•è®¿é—®iframeå†…å®¹
                        console.log('âš ï¸ è·¨åŸŸé™åˆ¶ï¼Œä½¿ç”¨å¤‡ç”¨æ–¹æ¡ˆ');
                    }
                });
            } catch (e) {
                console.log('å¹¿å‘Šå±è”½åˆå§‹åŒ–å¤±è´¥:', e);
            }

            // æ–¹æ³•2: é˜»æ­¢æ–°çª—å£æ‰“å¼€ï¼ˆå¤‡ç”¨æ–¹æ¡ˆï¼Œå³ä½¿è·¨åŸŸä¹Ÿèƒ½å·¥ä½œï¼‰
            window.addEventListener('beforeunload', function (e) {
                // é˜»æ­¢é¡µé¢è·³è½¬
            });

            // é˜»æ­¢window.open
            const originalOpen = window.open;
            window.open = function (url, name, features) {
                console.log('ğŸš« å·²é˜»æ­¢å¼¹çª—:', url);
                return null;
            };
        }
    </script>

</body>

</html>